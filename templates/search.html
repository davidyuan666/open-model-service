<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLIP Image-Text Similarity</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="p-8">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="text-input">
                    Enter Text:
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="text-input" type="text" placeholder="Enter text here">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="image-input">
                    Upload Image:
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="image-input" type="file" accept="image/*">
            </div>
            <div class="flex items-center justify-between">
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" id="submit-btn">
                    Calculate Similarity
                </button>
            </div>
            <div id="result" class="mt-4 text-gray-700"></div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#submit-btn').click(function() {
                var text = $('#text-input').val();
                var imageFile = $('#image-input')[0].files[0];
                
                if (!text || !imageFile) {
                    alert('Please enter text and select an image.');
                    return;
                }

                var formData = new FormData();
                formData.append('image', imageFile);

                // First, upload the image
                $.ajax({
                    url: '/image/upload_image',
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function(response) {
                        // Now send the text and image path for CLIP processing
                        var data = {
                            text: text,
                            image: response.image_name,
                            language: 'chn'  // 默认使用中文
                        };

                        $.ajax({
                            url: '/image/clip/search',
                            type: 'POST',
                            data: JSON.stringify(data),
                            contentType: 'application/json',
                            dataType: 'json',
                            success: function(response) {
                                $('#result').html('Similarity Score: ' + response.similarity_score.toFixed(4));
                            },
                            error: function(xhr, status, error) {
                                $('#result').html('Error: ' + xhr.responseJSON.error);
                            }
                        });
                    },
                    error: function(xhr, status, error) {
                        $('#result').html('Error uploading image: ' + xhr.responseJSON.error);
                    }
                });
            });

        });
    </script>
</body>
</html>